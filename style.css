/* === VARIABLES & THEME === */
:root {
    --bg: #ffffff;
    --sec: #f2f2f7; /* iOS Light Gray */
    --surface: #ffffff;
    --text: #000000;
    --text-sec: #8e8e93;
    --border: #e5e5ea;
    
    --blue: #007aff; /* Main Accent Color */
    --green: #34c759;
    --red: #ff3b30;
    
    --msg-in: #e9e9eb;
    --msg-out: var(--blue);
    --msg-out-text: #ffffff;
    
    --radius: 18px;
    --shadow: 0 4px 12px rgba(0,0,0,0.08);
}

@media (prefers-color-scheme: dark) {
    :root {
        --bg: #000000;
        --sec: #1c1c1e;
        --surface: #1c1c1e;
        --text: #ffffff;
        --text-sec: #98989d;
        --border: #2c2c2e;
        
        --msg-in: #2c2c2e;
        --msg-out: #0a84ff;
    }
}

/* === RESET & BASE === */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); height: 100dvh; display: flex; overflow: hidden; font-size: 15px; }

/* Custom Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: rgba(128,128,128,0.3); border-radius: 3px; }
::-webkit-scrollbar-track { background: transparent; }

/* === LAYOUT === */
.sidebar { width: 350px; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: var(--bg); z-index: 2; position: relative; transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
.chat-wrap { flex: 1; display: flex; flex-direction: column; background: var(--surface); position: relative; z-index: 1; transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }

/* Mobile Logic */
@media (max-width: 768px) {
    .sidebar { width: 100%; position: absolute; inset: 0; }
    .chat-wrap { position: absolute; inset: 0; transform: translateX(100%); }
    .chat-wrap.active { transform: translateX(0); }
    .sidebar.hidden { transform: translateX(-20%); opacity: 0; pointer-events: none; }
}

/* === HEADERS === */
.header, .chat-header { height: 60px; padding: 0 16px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid var(--border); background: rgba(var(--bg), 0.8); backdrop-filter: blur(10px); flex-shrink: 0; }
.chat-header { background: rgba(var(--surface), 0.95); }

/* Avatar */
.avatar { width: 44px; height: 44px; border-radius: 50%; background: var(--sec); object-fit: cover; border: 1px solid var(--border); cursor: pointer; flex-shrink: 0; }
.avatar.large { width: 80px; height: 80px; margin: 10px auto; display: block; border: none; }
.profile-summary { display: flex; align-items: center; gap: 10px; flex: 1; cursor: pointer; }

/* === SEARCH BAR === */
.search-bar-container { padding: 10px 16px; border-bottom: 1px solid var(--border); background: var(--bg); }
.search-input-wrapper { background: var(--sec); border-radius: 10px; padding: 8px 12px; display: flex; align-items: center; gap: 8px; color: var(--text-sec); }
.search-input-wrapper input { background: transparent; border: none; flex: 1; color: var(--text); font-size: 15px; }

/* === LISTS === */
.contact-list { flex: 1; overflow-y: auto; }
.contact { padding: 12px 16px; display: flex; gap: 12px; align-items: center; cursor: pointer; transition: background 0.2s; border-bottom: 1px solid transparent; }
.contact:hover { background: var(--sec); }
.contact.active { background: var(--blue); color: white; }
.contact.active .contact-last, .contact.active .contact-time { color: rgba(255,255,255,0.8); }
.contact-info { flex: 1; overflow: hidden; }
.contact-top { display: flex; justify-content: space-between; margin-bottom: 4px; }
.contact-name { font-weight: 600; font-size: 16px; }
.contact-time { font-size: 12px; color: var(--text-sec); }
.contact-last { font-size: 14px; color: var(--text-sec); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 4px; }

/* === MESSAGES === */
.messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 6px; background-image: url('https://web.telegram.org/img/bg_0.png'); background-size: cover; background-blend-mode: overlay; background-color: var(--surface); }
.msg { max-width: 75%; padding: 8px 12px; border-radius: var(--radius); font-size: 16px; position: relative; word-wrap: break-word; animation: msgPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
.msg.in { background: var(--msg-in); align-self: flex-start; border-bottom-left-radius: 4px; }
.msg.out { background: var(--msg-out); color: var(--msg-out-text); align-self: flex-end; border-bottom-right-radius: 4px; }

.msg img, .msg video { max-width: 100%; border-radius: 12px; display: block; margin: 4px 0; cursor: pointer; }
.msg-meta { font-size: 11px; display: flex; justify-content: flex-end; align-items: center; gap: 4px; opacity: 0.7; margin-top: 2px; }
.status-icon { font-size: 10px; }
.status-icon.read { color: #6cc1ff; } /* Light blue checks */

/* Circle Video Note */
.msg.video_note { background: transparent !important; box-shadow: none; padding: 0; }
.circle-video { width: 240px; height: 240px; border-radius: 50%; object-fit: cover; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

/* Audio Player */
.audio-msg { width: 220px; display: flex; align-items: center; gap: 10px; }
.play-btn { background: var(--surface); color: var(--blue); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; flex-shrink: 0; }

/* Reply Panel */
.reply-panel { padding: 10px; background: var(--surface); border-top: 1px solid var(--border); display: none; align-items: center; gap: 10px; animation: slideUp 0.2s; }
.reply-panel.show { display: flex; }
.reply-line { width: 3px; background: var(--blue); border-radius: 2px; height: 36px; }
.reply-name { color: var(--blue); font-size: 13px; font-weight: 600; }
.reply-text { font-size: 13px; color: var(--text-sec); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* === INPUT BAR === */
.input-bar { background: var(--surface); padding: 10px; display: flex; gap: 8px; align-items: flex-end; border-top: 1px solid var(--border); position: relative; z-index: 5; }
.input-field { flex: 1; background: var(--sec); border-radius: 20px; padding: 10px 14px; border: none; color: var(--text); resize: none; max-height: 120px; font-size: 16px; line-height: 1.4; }
.btn-icon { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: var(--blue); font-size: 20px; cursor: pointer; border: none; background: none; transition: 0.2s; }
.btn-icon:hover { background: rgba(0,0,0,0.05); border-radius: 50%; }
.btn-icon.rec { color: var(--red); animation: pulse 1.5s infinite; background: rgba(255, 59, 48, 0.1); border-radius: 50%; }

/* Emoji Picker */
.emoji-container { position: absolute; bottom: 70px; left: 10px; z-index: 10; display: none; box-shadow: var(--shadow); border-radius: 12px; }
.emoji-container.open { display: block; animation: popIn 0.2s; }

/* === MODALS === */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
.modal-overlay.open { opacity: 1; }
.modal { background: var(--bg); width: 90%; max-width: 400px; padding: 24px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 16px; max-height: 85vh; overflow-y: auto; }

/* Modal Animations */
.fade-in { transform: scale(0.95); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
.modal-overlay.open .fade-in { transform: scale(1); }
.bottom-sheet { position: absolute; bottom: 0; width: 100%; max-width: 100%; border-radius: 24px 24px 0 0; transform: translateY(100%); transition: transform 0.3s; }
.modal-overlay.open .bottom-sheet { transform: translateY(0); }

/* Inputs in Modal */
.input-group input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); background: var(--sec); color: var(--text); font-size: 16px; margin-bottom: 8px; }
.modal-btn { padding: 14px; border-radius: 14px; border: none; font-weight: 600; cursor: pointer; font-size: 16px; width: 100%; transition: 0.2s; }
.modal-btn.primary { background: var(--blue); color: white; }
.modal-btn.sec { background: var(--sec); color: var(--text); }
.modal-btn.danger { background: rgba(255, 59, 48, 0.1); color: var(--red); }

/* === EXTRAS === */
.fab { position: absolute; bottom: 20px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: var(--blue); color: white; border: none; box-shadow: 0 4px 15px rgba(0,122,255,0.4); font-size: 24px; cursor: pointer; z-index: 100; transition: transform 0.2s; display: flex; align-items: center; justify-content: center; }
.fab:active { transform: scale(0.9); }

.fab-menu { position: absolute; bottom: 90px; right: 20px; display: none; flex-direction: column; gap: 10px; z-index: 99; }
.fab-item { background: var(--bg); padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; }

/* Skeleton Loader */
.skeleton-list { padding: 15px; display: flex; flex-direction: column; gap: 15px; }
.skeleton-item { height: 60px; background: linear-gradient(90deg, var(--sec) 25%, var(--border) 50%, var(--sec) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 12px; }

/* Drag & Drop */
.drop-zone { position: fixed; inset: 0; background: rgba(0,122,255,0.9); z-index: 9999; display: none; align-items: center; justify-content: center; flex-direction: column; color: white; font-size: 20px; font-weight: bold; backdrop-filter: blur(5px); }
.drop-zone.active { display: flex; animation: fadeIn 0.2s; }
.drop-zone i { font-size: 60px; margin-bottom: 20px; animation: bounce 1s infinite; }

/* Theme Circles */
.theme-grid { display: flex; gap: 15px; justify-content: center; padding: 10px 0; }
.theme-circle { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s; }
.theme-circle:active { transform: scale(0.9); }

/* Animations */
@keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
@keyframes msgPop { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
@keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.4); } 70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(255, 59, 48, 0); } 100% { transform: scale(1); } }
@keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
